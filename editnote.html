<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="style.css">
    <title>Notepad</title>
    <script>

/**
 * Format the date for the design
 */
function formatDate(date_note){
    let date_array = date_note.toDateString().split(" ");
    let day_name = date_array[0];
    let month_name = date_array[1];
    let day_number = date_array[2];
    let year = date_array[3];
    return month_name + ' ' + day_number + ',' + year;
}

/**
 * Get the note key from the query param 
 */
function getNoteKey(){
    // Recovering of the note key from query param 'note'
    let note_key = gb.location.params()['note'];
    return note_key
}

/**
 * Manage the note that will be update or delete
 */
function manageNote(){
    note_key = getNoteKey();
    gb.storage.getItem(note_key, (item) => {
        let note_date_container = document.getElementById('note-date');
        let note_date = note_date_container.firstElementChild;
        let note_text = document.getElementById('note-text');
        let date = (new Date(parseInt(note_key.split('_')[1])));
        note_text.innerHTML = item;
        note_date.innerHTML = formatDate(date);
        // Event listener on form change and update the gb storage with the new content
        note_text.addEventListener('DOMSubtreeModified', (event) => {
            item = note_text.innerHTML;
            gb.storage.setItem(note_key, item);
        });
    });
}

/**
 * Delete the note with the help of the note key from GB storage
 * and back to the index with all notes
 */
function deleteNote(note_key){
    gb.storage.removeItem(note_key);
    gb.location.back();
}

    </script>
</head>
<body>
    <div class="note-container">
        <div class="note-block">
            <div class="note-date" id="note-date">
                <div>
                    May 21,2020
                </div>
                <div onclick="deleteNote(getNoteKey());">
                    <i class="fa fa-trash" aria-hidden="true" style="font-size: 20px;"></i>
                </div>
            </div>
            <p><span class="textarea" role="textbox" contenteditable id="note-text"></span></p>
        </div>
    </div>
</body>
<script>

gb.onload =  () => {
    manageNote();
}

</script>
</html>